<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>广州美食体验讨论 - 羊城乐游汇</title>
    
    <!-- 引入外部资源 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-router@3.5.3/dist/vue-router.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuex@3.6.2/dist/vuex.js"></script>
    <!-- 引入Vuex Store和Router -->
    <script src="js/store.js"></script>
    <script src="js/router.js"></script>
    <!-- 引入主JavaScript文件 -->
    <script src="js/main.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    
    <!-- 引入自定义样式 -->
    <link rel="stylesheet" href="css/style.css">

    <!-- Tailwind配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#D4AF37', // 金色（广州特色）
                        secondary: '#006400', // 深绿色（代表广州的自然景观）
                        accent: '#8B0000', // 深红色（代表传统文化）
                        neutral: '#F5F5DC', // 米色（温暖色调）
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        serif: ['Georgia', 'serif'],
                    },
                },
            }
        }
    </script>
    
    <!-- 配置自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-hover {
                @apply transition-all duration-300 hover:shadow-lg hover:-translate-y-1;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- 导航栏 -->
        <navbar></navbar>

    <!-- 主内容 -->
    <main class="container mx-auto px-4 py-24">
        <div class="flex flex-col md:flex-row gap-8">
            <!-- 左侧：讨论主题 -->
            <div class="md:w-2/3">
                <!-- 主题标题 -->
                <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                    <h1 class="text-3xl font-bold text-secondary mb-3">广州美食体验</h1>
                    <p class="text-gray-600">分享你在广州品尝到的美食，推荐好吃的餐厅和特色菜品。</p>
                    <div class="mt-4 text-sm text-gray-500">
                        <span>最后更新: 2024年2月15日</span>
                        <span class="mx-2">•</span>
                        <span>参与人数: <span class="text-primary font-semibold">128</span></span>
                        <span class="mx-2">•</span>
                        <span>回复数: <span class="text-primary font-semibold">256</span></span>
                    </div>
                </div>
                
                <!-- 留言表单 -->
                <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                    <h3 class="text-xl font-bold text-secondary mb-4">分享你的美食体验</h3>
                    <form @submit.prevent="submitFeedback" class="space-y-4">
                        <div class="mb-4">
                            <label for="feedback-content" class="block text-sm font-medium text-gray-700 mb-1">留言内容</label>
                            <textarea id="feedback-content" v-model="feedback.content" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" rows="4" placeholder="分享你在广州品尝到的美食，推荐好吃的餐厅和特色菜品..." required></textarea>
                            <p v-if="feedback.errors.content" class="text-xs text-red-500 mt-1">{{ feedback.errors.content }}</p>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">评分</label>
                            <div class="flex items-center space-x-2" id="feedback-rating">
                                <button type="button" v-for="star in 5" :key="star" @click="feedback.rating = star" class="text-2xl">
                                    <i :class="star <= feedback.rating ? 'fa fa-star text-primary' : 'fa fa-star-o text-gray-300'"></i>
                                </button>
                            </div>
                            <p v-if="feedback.errors.rating" class="text-xs text-red-500 mt-1">{{ feedback.errors.rating }}</p>
                        </div>
                        
                        <button type="submit" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors font-medium flex items-center space-x-2" :disabled="feedback.isSubmitting">
                            <i v-if="!feedback.isSubmitting" class="fa fa-paper-plane"></i>
                            <i v-else class="fa fa-spinner fa-spin"></i>
                            <span>{{ feedback.isSubmitting ? '提交中...' : '提交留言' }}</span>
                        </button>
                    </form>
                </div>
                
                <!-- 留言列表 -->
                <div class="space-y-6" id="feedback-list">
                    <!-- 无留言提示 -->
                    <div v-if="$store.state.feedbacks.length === 0" class="bg-white rounded-xl shadow-md p-8 text-center">
                        <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fa fa-comments text-3xl text-primary"></i>
                        </div>
                        <h3 class="text-xl font-bold text-secondary mb-2">还没有留言</h3>
                        <p class="text-gray-600 mb-6">成为第一个分享广州美食体验的人吧！</p>
                        <button @click="scrollToFeedbackForm" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors font-medium">
                            发表第一条留言
                        </button>
                    </div>
                    
                    <!-- 留言列表 -->
                    <div v-for="feedback in $store.state.feedbacks" :key="feedback.id" class="bg-white rounded-xl shadow-md p-6 card-hover">
                        <div class="flex items-start space-x-4 mb-4">
                            <img :src="feedback.avatar" :alt="feedback.name + '的头像'" class="w-12 h-12 rounded-full object-cover">
                            <div>
                                <div class="flex items-center space-x-2">
                                    <h4 class="font-semibold text-gray-800">{{ feedback.name }}</h4>
                                    <span class="text-xs px-2 py-1 bg-primary/10 text-primary rounded-full">美食爱好者</span>
                                </div>
                                <p class="text-sm text-gray-500">{{ feedback.createdAt ? new Date(feedback.createdAt).toLocaleString('zh-CN') : '' }}</p>
                            </div>
                        </div>
                        
                        <!-- 评分 -->
                        <div class="flex items-center mb-3">
                            <div class="flex items-center mr-2">
                                <i v-for="star in 5" :key="star" :class="star <= feedback.rating ? 'fa fa-star text-primary' : 'fa fa-star-o text-gray-300'"></i>
                            </div>
                            <span class="text-sm text-gray-600">{{ feedback.rating }}/5</span>
                        </div>
                        
                        <!-- 留言内容 -->
                        <p class="text-gray-600 mb-4">{{ feedback.content }}</p>
                        
                        <!-- 操作按钮 -->
                        <div class="flex items-center space-x-6 text-sm text-gray-500">
                            <button @click="likeFeedback(feedback.id)" class="flex items-center space-x-1 hover:text-primary transition-colors">
                                <i :class="feedback.likedByUser ? 'fa fa-thumbs-up' : 'fa fa-thumbs-o-up'"></i>
                                <span>{{ feedback.likes }}</span>
                            </button>
                            <button class="flex items-center space-x-1 hover:text-primary transition-colors">
                                <i class="fa fa-comment-o"></i>
                                <span>{{ feedback.replies }}</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 右侧：边栏 -->
            <div class="md:w-1/3">
                <!-- 发表新话题 -->
                <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                    <h3 class="text-lg font-bold text-secondary mb-4">发表新话题</h3>
                    <button id="openNewTopicModal" class="w-full px-4 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors font-medium">
                        <i class="fa fa-plus mr-2"></i> 创建新话题
                    </button>
                </div>
                
                <!-- 热门话题 -->
                <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                    <h3 class="text-lg font-bold text-secondary mb-4">热门话题</h3>
                    <div class="space-y-3">
                        <div class="flex items-center space-x-3 card-hover p-2 rounded-lg">
                            <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center">
                                <i class="fa fa-cutlery text-primary"></i>
                            </div>
                            <div class="flex-1">
                                <a href="#" class="text-sm font-medium text-gray-800 hover:text-primary transition-colors">广州早茶攻略</a>
                                <p class="text-xs text-gray-500">128人参与</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3 card-hover p-2 rounded-lg">
                            <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center">
                                <i class="fa fa-map-marker-alt text-primary"></i>
                            </div>
                            <div class="flex-1">
                                <a href="#" class="text-sm font-medium text-gray-800 hover:text-primary transition-colors">天河区美食推荐</a>
                                <p class="text-xs text-gray-500">96人参与</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3 card-hover p-2 rounded-lg">
                            <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center">
                                <i class="fa fa-star text-primary"></i>
                            </div>
                            <div class="flex-1">
                                <a href="#" class="text-sm font-medium text-gray-800 hover:text-primary transition-colors">必吃粤菜餐厅</a>
                                <p class="text-xs text-gray-500">78人参与</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 活跃用户 -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-bold text-secondary mb-4">活跃用户</h3>
                    <div class="space-y-3">
                        <div class="flex items-center space-x-3">
                            <img src="assets/images/food/chashaobao.jpg" alt="用户头像" class="w-10 h-10 rounded-full object-cover">
                            <div class="flex-1">
                                <p class="text-sm font-medium text-gray-800">美食达人小王</p>
                                <p class="text-xs text-gray-500">234篇帖子</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <img src="assets/images/food/jiangzhuangnai.jpg" alt="用户头像" class="w-10 h-10 rounded-full object-cover">
                            <div class="flex-1">
                                <p class="text-sm font-medium text-gray-800">本地吃货</p>
                                <p class="text-xs text-gray-500">187篇帖子</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <img src="assets/images/food/changfen.jpg" alt="用户头像" class="w-10 h-10 rounded-full object-cover">
                            <div class="flex-1">
                                <p class="text-sm font-medium text-gray-800">旅行博主小张</p>
                                <p class="text-xs text-gray-500">156篇帖子</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
        <!-- 页脚 -->
        <footer-component></footer-component>
    
    <!-- 登录模态框 -->
    <div id="loginModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl p-8 max-w-md w-full mx-4 relative">
            <button id="closeLoginModal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-xl">
                <i class="fa fa-times"></i>
            </button>
            <h2 class="text-2xl font-bold text-secondary mb-6 text-center">登录</h2>
            
            <form @submit.prevent="loginUser">
                <!-- 邮箱 -->
                <div class="mb-4">
                    <label for="loginEmail" class="block text-sm font-medium text-gray-700 mb-1">邮箱</label>
                    <input type="email" id="loginEmail" v-model="login.email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="请输入邮箱">
                    <p v-if="login.errors && login.errors.email" class="text-xs text-red-500 mt-1">{{ login.errors.email }}</p>
                </div>
                
                <!-- 密码 -->
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-1">
                        <label for="loginPassword" class="block text-sm font-medium text-gray-700">密码</label>
                        <a href="#" class="text-sm text-primary hover:text-primary/80 transition-colors">忘记密码？</a>
                    </div>
                    <div class="relative">
                        <input :type="login.showPassword ? 'text' : 'password'" id="loginPassword" v-model="login.password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="请输入密码">
                        <button type="button" @click="togglePasswordVisibility" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700">
                            <i :class="login.showPassword ? 'fa fa-eye-slash' : 'fa fa-eye'"></i>
                        </button>
                    </div>
                    <p v-if="login.errors && login.errors.password" class="text-xs text-red-500 mt-1">{{ login.errors.password }}</p>
                </div>
                
                <!-- 记住我 -->
                <div class="flex items-center mb-6">
                    <input type="checkbox" id="rememberMe" v-model="login.rememberMe" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                    <label for="rememberMe" class="ml-2 block text-sm text-gray-700">记住我</label>
                </div>
                
                <!-- 登录按钮 -->
                <button type="submit" class="w-full py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors font-medium">
                    登录
                </button>
                
                <!-- 分隔线 -->
                <div class="flex items-center my-6">
                    <div class="flex-1 h-px bg-gray-200"></div>
                    <span class="px-4 text-sm text-gray-500">或者</span>
                    <div class="flex-1 h-px bg-gray-200"></div>
                </div>
                
                <!-- 第三方登录 -->
                <div class="flex space-x-4">
                    <button type="button" class="flex-1 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                        <i class="fab fa-weixin text-lg"></i>
                    </button>
                    <button type="button" class="flex-1 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                        <i class="fab fa-qq text-lg text-blue-500"></i>
                    </button>
                    <button type="button" class="flex-1 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                        <i class="fab fa-weibo text-lg text-red-500"></i>
                    </button>
                </div>
                
                <!-- 注册链接 -->
                <p class="text-center text-sm text-gray-500 mt-6">还没有账号？ <a href="register.html" class="text-primary hover:text-primary/80 transition-colors font-medium">立即注册</a></p>
            </form>
        </div>
    </div>
    
    <!-- 发表新话题模态框 -->
    <div id="newTopicModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl p-8 max-w-2xl w-full mx-4 relative max-h-[80vh] overflow-y-auto">
            <button id="closeNewTopicModal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-xl">
                <i class="fas fa-times"></i>
            </button>
            <h2 class="text-2xl font-bold text-secondary mb-6 text-center">发表新话题</h2>
            
            <form id="newTopicForm">
                <!-- 话题标题 -->
                <div class="mb-4">
                    <label for="topicTitle" class="block text-sm font-medium text-gray-700 mb-1">话题标题</label>
                    <input type="text" id="topicTitle" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="请输入话题标题" required>
                </div>
                
                <!-- 话题分类 -->
                <div class="mb-4">
                    <label for="topicCategory" class="block text-sm font-medium text-gray-700 mb-1">话题分类</label>
                    <select id="topicCategory" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" required>
                        <option value="">请选择分类</option>
                        <option value="gastronomy">美食体验</option>
                        <option value="attractions">景点打卡</option>
                        <option value="culture">文化探索</option>
                        <option value="travel">出行指南</option>
                        <option value="others">其他</option>
                    </select>
                </div>
                
                <!-- 话题内容 -->
                <div class="mb-4">
                    <label for="topicContent" class="block text-sm font-medium text-gray-700 mb-1">话题内容</label>
                    <textarea id="topicContent" rows="8" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="请输入话题内容" required></textarea>
                </div>
                
                <!-- 提交按钮 -->
                <div class="flex justify-end space-x-3">
                    <button type="button" id="cancelNewTopic" class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-medium">
                        取消
                    </button>
                    <button type="submit" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors font-medium">
                        发布话题
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    </div>
    
    <!-- 引入JavaScript -->
    <script src="js/main.js"></script>
    
    <!-- 页面特定初始化 -->
    <script>
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 确保Vue实例已经加载
            if (window.app) {
                // 加载留言数据
                window.app.$store.dispatch('loadFeedbacks');
                // 初始化暗黑模式状态
                const darkMode = localStorage.getItem('darkMode') === 'true';
                document.documentElement.classList.toggle('dark', darkMode);
                // 更新Navbar组件的暗黑模式状态
                const navbar = window.app.$children.find(child => child.$el.tagName.toLowerCase() === 'navbar');
                if (navbar) {
                    navbar.darkMode = darkMode;
                    navbar.updateDarkModeUI();
                }
            }
        });
    </script>
</body>
</html>